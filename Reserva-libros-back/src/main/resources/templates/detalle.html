<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalle Libro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/fragments.css}">
  <link rel="stylesheet" th:href="@{/css/detalle.css}">
</head>

<body>
  <!-- Incluir el encabezado -->
  <div th:insert="~{fragments :: header}"></div>
  <!--Cuerpo-->

  <div class="container my-5">
    <a th:href=@{/catalogo} class="btn btn-danger btn-sm">
      Volver al Cat谩logo
    </a>
    <h2 class="mb-4 fw-bold">Detalle libro</h2>

    <div class="book-detail">
      <div class="row">
        <!-- Columna de imagen y datos -->
        <div class="col-md-4 text-center mb-4 mb-md-0">
          <img th:src="${libro.imagenUrl}" th:alt="${libro.titulo}" class="book-image mb-3">
          <h5 class="fw-bold" th:text="${libro.titulo}">Fahrenheit 451</h5>
          <p class="mb-1"><strong>Autor:</strong> <span th:text="${libro.autor}">Autor</span></p>
          <p class="mb-1"><strong>Fecha de publicaci贸n:</strong> <span th:text="${libro.fechaPublicacion}">Fecha</span>
          </p>
          <p class="mb-1"><strong>Editorial:</strong> <span th:text="${libro.editorial}">Editorial</span></p>
          <p class="mb-3"><strong>ISBN:</strong> <span th:text="${libro.isbn}">ISBN</span></p>
          <a th:href="@{/prestamo/{slug}(slug=${libro.slug})}" class="btn btn-purple w-100"
            sec:authorize="isAuthenticated()">Solicitar
            pr茅stamo</a>
          <button type="button" class="btn btn-purple w-100" data-bs-toggle="modal" data-bs-target="#staticBackdrop"
            sec:authorize="isAnonymous()">
            Inicie sesi贸n para solicitar
          </button>
          <!-- Modal de Inicio de Sesi贸n -->
          <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="staticBackdropLabel">Iniciar sesi贸n</h1>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                  <!-- Alerta de error de login -->
                  <div th:if="${param.error}" class="alert alert-danger" role="alert">
                    Usuario o contrase帽a incorrectos.
                  </div>
                  <!-- Alerta de logout exitoso -->
                  <div th:if="${param.logout}" class="alert alert-success" role="alert">
                    Has cerrado sesi贸n correctamente.
                  </div>
                  <!-- Formulario de login -->
                  <form th:action="@{/login}" method="post">
                    <div class="mb-3">
                      <label for="username" class="form-label">Correo electr贸nico</label>
                      <input type="email" class="form-control" id="username" name="username"
                        placeholder="usuario@correo.com" required>
                    </div>
                    <div class="mb-3">
                      <label for="password" class="form-label">Contrase帽a</label>
                      <input type="password" class="form-control" id="password" name="password"
                        placeholder="Ingrese su contrase帽a" required>
                    </div>
                    <div class="text-end">
                      <button type="submit" class="btn btn-primary">Ingresar</button>
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <a class="btn btn-secondary" th:href="@{/registrar}">Registrar</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Columna de descripci贸n y disponibilidad -->
        <div class="col-md-8">
          <h5 class="section-title">Descripci贸n</h5>
          <p th:text="${libro.descripcion}" style="text-align: justify;">
            Una distop铆a en la que los libros est谩n prohibidos y los "bomberos" se encargan
            de quemarlos. El protagonista, Montag, comienza a cuestionar esta realidad.
          </p>
          <p class="mb-1"><strong>Genero:</strong> <span class="btn btn-info" th:text="${libro.genero}"></span></p>
          <h5 class="section-title">Disponibilidad</h5>
          <div class="form-check mb-2">
            <div class="text-muted ms-3">
              <strong>Ejemplares disponibles:</strong> <span th:text="${ejemplares.size()}">0</span>
            </div>
            <div class="mt-3">
              <a href="ruta-del-libro.pdf" class="btn btn-success" download>
                 Descargar libro
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div th:if="${toastError}" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;">
    <div class="toast align-items-center text-bg-danger border-0 show" role="alert" aria-live="assertive"
      aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          <span th:text="${toastError}">Error al procesar la solicitud</span>
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
          aria-label="Close"></button>
      </div>
    </div>
  </div>


  <!-- Incluir el pie de p谩gina -->
  <div th:insert="~{fragments :: footer}"></div>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const toastEl = document.querySelector('.toast');
      if (toastEl) {
        const toast = new bootstrap.Toast(toastEl);
        toast.show();
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
    crossorigin="anonymous"></script>
</body>

</html>